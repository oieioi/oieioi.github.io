<!DOCTYPE html>
<html lang="ja">
  <head>
    <meta content="text/html;charset=utf-8" http-equiv="Content-Type">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <meta content="utf-8" http-equiv="encoding">
    <title>opacitized color code</title>
    <style>
body {
  font-family: Courier, sans-serif;
  margin: 0;
  padding: 0;
  background: white;
}
.controller {
  display: flex;
  flex-wrap: wrap;
  flex-direction: column;
  font-size: 20pt;
}

.controller label {
  flex-basis: 49%;
}

.controller input {
  font-size: 20pt;
  font-family: Courier, sans-serif;
  margin: 10px;
  text-align: right;
  padding: 10px;
  border: 1px solid;
  border-radius: 3px;
}
.result {
  display: flex;
  flex-direction: row;
  justify-content: center;
  align-items: center;
}
.color {
  flex-shrink: 1;
  flex-basis: 33%;
  font-size: 20pt;
  text-align: center;
  padding: 100px 0;
}

@media (max-width: 640px) {
  .result {
    flex-direction: column;
  }
  .color {
    flex-basis: 100%;
      padding: 50px 0;
    display: block;
    width: 100%;
  }
}

    </style>
  </head>
  <body id="body">
    <section class="controller">
      <label for="color-code-value">RGB16:</label><input id="color-code-value" type="text" value="faafff" onChange="change();">
      <label for="opacity-value">opacity:</label><input id="opacity-value" type="text" value="0.5" onChange="change();">
    </section>

    <section class="result">
      <div class="color" id='raw'>raw</div>
      <div class="color" id='opacity'>opacity</div>
      <div class="color" id='opacitized'>opacitized</div>
    </section>

    <script>
window.change = function(){
  var opacity = Number(document.getElementById('opacity-value').value);
  var color = document.getElementById('color-code-value').value;
  var fontColor = calcComplementaryColor(color);

  document.getElementById('raw').style.backgroundColor = '#' + color;
  document.getElementById('raw').style.color = '#' + fontColor;
  document.getElementById('raw').textContent = '#' + color;

  document.getElementById('opacity').style.backgroundColor = '#' + color;
  document.getElementById('opacity').style.opacity = opacity;
  document.getElementById('opacity').style.color = '#' + fontColor;
  document.getElementById('opacity').textContent = 'opacity: ' + opacity;

  var opacitizedColorCode = calcOpacitizedColorCode(color, opacity);
  var opacitizedFontColor = calcOpacitizedColorCode(fontColor, opacity);

  document.getElementById('opacitized').style.backgroundColor = '#' + opacitizedColorCode;
  document.getElementById('opacitized').style.color = '#' + opacitizedFontColor;
  document.getElementById('opacitized').textContent = '#' + opacitizedColorCode;

};

window.calcOpacitizedColorCode = function (colorCode, opacity) {
  colorCode = colorCode.replace('#', '');

  var red = colorCode.slice(0,2);
  var green = colorCode.slice(2,4);
  var blue = colorCode.slice(4,6);

  var opacitizedColorCode = [red, green, blue].map(function(colorCode){
    return calcOpacitized(colorCode, opacity);
  }).join('');

  return opacitizedColorCode;
}

window.calcOpacitized = function (hex, opacity) {
  var value = parseInt(hex, 16);
  var max = 255;

  var opacitized = max - Math.ceil(opacity * (max - value));
  return ("0" + opacitized.toString(16)).slice(-2);
};

// 補色
window.calcComplementaryColor = function(colorCode){
  colorCode = colorCode.replace('#', '');

  var red = colorCode.slice(0,2);
  var green = colorCode.slice(2,4);
  var blue = colorCode.slice(4,6);

  return [red, green, blue].map(function(c){
    return ("0" + (255 - parseInt(c, 16)).toString(16)).slice(-2);
  }).join('');

}

window.change();
    </script>
    <section class="description">
      #000000 を opacity 0.5で計算した結果は #7f7f7f になると思ってたけど、Chromeの場合そうならない。Firefoxはだいたい同じになる。なんでだろう。
      <a href='/'>top</a>
    </section>
  </body>
</html>
